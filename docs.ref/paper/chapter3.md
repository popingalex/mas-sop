3. 基于标准化应急流程的SAFE框架设计
在深入分析了应急救援场景对智能化、协同化、自适应能力的迫切需求（第二章）之后，本章旨在系统性地阐述我们提出的SAFE（Strategist, Awareness, Field Expert, Executor）多智能体框架的设计。SAFE框架的核心目标是构建一个能够模拟和增强应急响应初期核心规划与决策流程的智能化辅助系统。其设计深度借鉴了应急管理领域的成熟实践（如ICS、CPG 101），并结合多智能体系统（MAS）的理论，旨在通过结构化的角色分工、标准化的操作流程和明确的信息资产管理，提升应急响应的效率、规范性和决策支持能力。本章将从总体设计理念入手，详细介绍构成SAFE框架的关键要素。
3.1 SAFE框架设计目标与核心理念
设计SAFE框架的首要目标是弥合标准化应急规划理论与复杂应急响应实践之间的鸿沟。我们旨在创建一个能够理解并辅助执行标准化应急流程（SOP/EOP核心环节）的智能化工具，以应对传统人工模式在信息处理速度、知识整合效率和人力资源约束方面面临的挑战。SAFE框架并非意图完全替代人类指挥官，而是定位于一个强大的辅助决策支持系统，特别是在时间紧迫、信息爆炸的应急响应初期，能够快速生成结构化的态势分析、风险评估和初步行动方案，为人类决策者提供高质量的信息输入和方案选项。同时，该框架的设计也兼顾了其作为应急规划与指挥流程培训工具的潜力。
为了实现这一目标，SAFE框架的设计秉持以下核心理念：
基于角色的功能分解 (Role-Based Functional Decomposition): 借鉴ICS等成熟指挥体系的职能划分思想，将复杂的应急规划决策任务分解到不同的虚拟角色上。每个角色专注于特定的功能领域（如战略规划、态势感知、专业分析、执行接口），通过专业化分工提升处理效率和深度。这种设计旨在模拟一个高效协作的“数字应急团队”。
流程驱动的结构化协作 (Process-Driven Structured Collaboration): 应急响应本质上是一个流程驱动的过程。SAFE框架的核心运作依赖于一套标准化的操作规程（SOP），该SOP定义了应急响应初期规划的关键步骤、信息流转和角色职责。智能体之间的协作不再是随意的对话，而是严格遵循预设的SOP流程，通过结构化的消息和共享的信息资产进行任务传递和状态同步，确保协作的有序性和可追溯性。
资产中心的信息管理 (Asset-Centric Information Management): 将应急规划和决策过程中涉及的所有关键信息（如事件记录、态势报告、风险评估、行动方案、资源状态等）抽象为标准化的、可管理的“信息资产”。这些资产通过一个中央存储库（Asset Hub）进行持久化管理和共享，作为智能体决策的依据和流程流转的载体，确保信息的一致性和可复用性。
智能化赋能而非完全自主 (Intelligence Augmentation, Not Full Autonomy): 虽然SAFE框架利用先进的AI技术（特别是未来可以集成的LLM能力）来赋予角色认知和推理能力，但其定位是辅助人类决策者。框架的输出是结构化的报告和方案“草案”或“建议”，最终的判断、决策和行动指令仍需人类指挥官确认。同时，框架的设计应包含必要的接口，允许人类进行监督、干预和调整。
SAFE框架的关键组成要素
基于上述理念，SAFE框架主要由以下两个相互关联的核心要素构成：
SAFE团队 (SAFE Team - 角色体系): 这是框架的执行主体，由四个预先定义的、具有不同职责和能力的虚拟角色组成：
Strategist (S - 策略师): 负责整体流程的驱动、协调、目标设定、方案评估与整合决策。
Awareness (A - 感知者): 负责多源信息的收集、处理、融合，构建态势图景，并进行初步风险识别。
Field Expert (F - 领域专家): 负责提供特定领域的深度分析、风险评估和专业方案选项。
Executor (E - 执行者): 负责与外部（模拟的）执行验证环境交互，驱动方案模拟并反馈结果。
（各角色的详细职责将在3.2节阐述）
SAFE标准化操作规程 (SAFE SOP - 标准化流程): 这是框架运作的“剧本”，定义了应急响应初期规划与决策的核心步骤、每个步骤的目标、主导角色、关键输入输出（信息资产）以及与CPG 101/ICS 300等标准的对应关系。SOP确保了SAFE团队能够按照结构化的、符合应急管理最佳实践的方式进行协作。
（SOP的具体内容将在3.4节详细阐述）
通过这两个核心要素的有机结合——由明确定义的角色遵循标准化的流程，处理和生成结构化的信息资产（将在后续章节定义）——SAFE框架旨在构建一个能够有效模拟和辅助应急响应初期关键规划决策活动的智能化系统。接下来的章节将分别详细介绍角色体系、协作机制、SOP流程与行为模式的设计。

3.2 SAFE框架的角色体系设计：模拟与增强应急指挥功能
SAFE (Strategist, Awareness, Field Expert, Executor) 框架的核心设计理念在于通过构建一个由不同角色组成的智能化“数字应急团队”，来模拟和增强复杂突发事件应急响应中的关键指挥、规划与决策支持功能。我们没有采用同质化的智能体设计，而是依据应急管理实践中典型的功能需求，并借鉴成熟的应急指挥体系（如ICS）的组织原则，定义了四种具有明确职责边界和核心能力的异构角色。这种基于角色的设计旨在通过专业化分工提升信息处理的深度和效率，通过结构化协作确保任务流程的有序推进，并最终为人类指挥官提供高质量的决策辅助。本节将详细阐述SAFE框架中四种核心角色的设计理念、核心职责，并说明其与ICS及相关标准（如CPG 101, ICS 300）中对应功能的映射关系。
3.2.1 Strategist (S - 策略师): 应急响应的规划协调与决策中枢
在SAFE框架中，Strategist扮演着至关重要的战略规划、流程协调与综合决策角色。其设计灵感来源于事件指挥系统（ICS）中的事件指挥官 (Incident Commander, IC) 或统一指挥 (Unified Command, UC) 在设定总体目标、制定战略方向、进行最终决策方面的核心权威，同时也吸收了规划组长 (Planning Section Chief) 在驱动运作周期计划流程（Planning "P"）、整合各方信息、编纂应急行动计划（IAP）方面的关键职责[参考文献 ICS 300]。Strategist作为SAFE团队的“大脑”和“指挥官”，负责从宏观层面把握应急响应的方向和节奏。
Strategist的核心职责体现在对应急响应初期规划决策流程的驱动和整合上。它负责接收并确认初始事件信息，进行严重性初判，并启动整个响应与规划流程，这对应了ICS中初始响应阶段指挥权的建立和初步评估活动。在流程启动后，Strategist需要依据初步情况明确响应的初始目标和关键约束条件，为后续工作设定方向，这类似于ICS目标制定会议（Objectives Meeting）的早期阶段。
随着响应的展开，Strategist持续扮演着信息整合者和决策者的角色。它审阅由Awareness角色提供的综合态势信息和风险评估结果，模拟了IC/UC接收规划组（Planning Section）简报的过程。基于对全局态势的理解，Strategist的核心任务是制定具体的、符合SMART原则的行动目标与优先级，这直接映射了CPG 101中的“确定目标和目的”（Step 3）以及ICS Planning "P"中的目标制定会议环节。
在方案制定阶段，Strategist负责评估和选择由Field Expert生成的行动方案（Course of Action, CoA）选项。它需要依据既定的评估标准（如可行性、有效性、资源消耗、风险等，这些标准借鉴自CPG 101对方案分析的要求）进行权衡比较，最终确定推荐的行动方案。此过程模拟了ICS计划会议（Planning Meeting）中对不同战术选项进行评审和决策的关键环节。
方案确定后，Strategist还需主导资源的确认与计划的整合工作。它需要分析选定方案对关键资源的需求，并（通过框架机制）确认资源的可用性，识别潜在缺口，这对应了ICS Planning "P"中资源分配和计划会议的相关内容。最终，Strategist负责将所有关键决策要素——目标、选定方案、资源确认情况等——整合成一份结构化的应急行动计划，为后续的执行（无论是模拟还是现实）提供依据，这对应了CPG 101的“计划准备”（Step 5）阶段和IAP的最终形成过程。
在执行验证阶段，Strategist负责接收并审阅模拟执行的结果报告，将其与原计划进行对比，评估方案在模拟环境中的表现，并形成总结回顾，这类似于ICS流程结束后的行动后回顾（After-Action Review, AAR）准备工作。
为了有效履行这些职责，Strategist被设计为具备强大的逻辑推理、规划协调、信息整合和决策评估能力。它需要深刻理解应急响应的基本原则和标准化流程（如CPG 101和Planning "P"的逻辑），能够处理和权衡来自不同角色的信息与建议，并最终做出符合整体目标的、结构化的输出。
3.2.2 Awareness (A - 感知者): 态势构建与信息处理引擎
Awareness角色的核心使命是为SAFE框架构建一幅全面、准确、动态更新的应急态势图景 (Situational Picture)，并进行初步的风险识别与评估。其功能设计主要映射ICS中规划组（Planning Section）下的态势单元 (Situation Unit) 的核心职责，即负责所有事件相关信息的收集、处理、分析和展示[参考文献 ICS 300, Planning Section]。Awareness充当着SAFE团队的“眼睛”、“耳朵”和“信息处理器”，是形成共同作战图景（Common Operating Picture, COP）的基础。
在SAFE的工作流中，Awareness在接收到Strategist的启动指令后，首先承担全面的信息处理任务，这对应了CPG 101的“理解态势”（Step 2）阶段和ICS Planning "P"中的信息收集与分析环节。具体职责包括：
多源信息整合: 主动规划并（通过框架机制调用工具）从各种来源（模拟的现场报告、传感器数据、气象水文、地理信息系统、新闻媒体、社交网络、历史案例库、预案文档等）收集信息。
信息处理与验证: 对收集到的原始信息进行处理，包括清洗、去重、分类、摘要，并进行初步的交叉验证以评估信息的可信度。
关键要素提取与补全: 从海量、异构的信息中，精准提取对决策至关重要的关键信息要素（Key Information Elements），例如事件的精确时间、地点、性质、影响范围、人员伤亡、财产损失、危险物质情况、当前资源状态等。同时，识别信息缺口，并在可能的情况下（例如通过知识库推理或进一步查询）尝试补全缺失的关键要素。这是保障后续规划有效性的基础。
完成信息整合与要素提取后，Awareness的核心产出是综合态势分析与风险评估结果。这要求Awareness能够：
构建态势图景: 将结构化的要素信息进行时空关联和逻辑分析，形成对当前应急态势（包括事件发展阶段、地理蔓延趋势、主要影响对象、关键脆弱点、现有响应行动及其效果等）的整体理解和可视化呈现（逻辑上的），产出**《综合态势图景》**。
风险识别与初步评估: 基于态势图景和已识别的危险源信息，进行广度优先的风险识别，判断主要的风险类型、可能的演化路径、潜在的连锁反应和大致的严重等级，形成初步的风险评估意见，为Strategist的决策和Field Expert的深度评估提供输入。
此外，Awareness还需具备持续监测和动态更新的能力，不断接收新的信息输入，刷新对态势和风险的认知，并将重要变化及时传递给Strategist及其他相关角色，确保整个团队的操作基于最新的、尽可能准确的信息。
为了实现这些功能，Awareness角色被设计为具备卓越的信息检索、自然语言处理（包括理解和生成摘要）、信息融合、模式识别、逻辑推理和初步风险判断能力。它需要能够高效地处理复杂信息环境，并将其转化为结构化的、服务于决策的态势情报。
3.2.3 Field Expert (F - 领域专家): 专业分析与方案生成器
Field Expert在SAFE框架中扮演着提供深度专业知识、进行专项分析评估、并生成具体行动方案选项的关键角色。其功能直接映射ICS体系中的技术专家 (Technical Specialists)[参考文献 ICS 300, Planning Section]，这些专家可能来自不同领域（如水利、气象、化学、结构工程、医疗、公共卫生、地质、交通等），为特定问题提供不可或缺的专业判断和解决方案建议。在SAFE框架中，可以根据应急事件的性质，动态地激活一个或多个相关领域的Field Expert实例。
Field Expert的核心职责是在接收到Strategist分配的任务后，基于其专业领域知识和Awareness提供的态势信息，进行深入分析和方案制定：
深度风险评估与预测: 当Strategist基于初步判断认为需要对特定风险进行更深入的分析时，会调用相应的Field Expert。该专家需要利用其专业知识库、分析模型（可能通过框架机制调用外部工具）或LLM的专业推理能力，对特定风险（如堤坝溃决概率、化学品扩散范围、传染病传播速率、结构失稳可能性等）进行量化或定性的深度评估，并预测其未来发展趋势，产出包含专业见解和数据支撑的**《专项风险评估报告》**。这对应了ICS中技术专家为规划组提供专业输入的过程。
生成专业行动方案 (CoA) 选项: 在Strategist确定了具体的响应目标后，会请求相关领域的Field Expert制定达成该目标的具体行动方案选项。Field Expert需要结合目标要求、当前态势、风险评估结果以及自身的专业知识和实践经验，生成一个或多个具体的、包含关键行动步骤、所需核心资源类型（专业角度）、预期效果和主要风险考量的行动方案 (CoA) 选项。这些方案应尽可能符合相关领域的规范和最佳实践。这对应了ICS中行动部门或技术专家在战术会议（Tactics Meeting）前后为达成目标而构思具体行动方法的过程。
为了保证其专业性和可靠性，Field Expert的设计强调：
领域知识整合: 需要有效整合特定领域的知识，这可能通过专门训练的LLM、外挂的专业知识库、规则引擎或案例库（通过RAG等技术访问）来实现。
分析与推理能力: 需要具备基于专业知识进行复杂分析、因果推断和预测的能力。
方案生成能力: 能够将分析结果转化为结构化的、具有可操作性的行动方案建议。
（潜在）跨专家协作: 在处理跨领域复杂问题时，不同领域的Field Expert之间可能需要进行信息共享或协同分析（由Strategist协调），以形成更全面的判断。
Field Expert的存在，旨在弥补通用LLM在特定专业领域深度和可靠性上的不足，为SAFE框架提供关键的“专业智慧”，确保其生成的分析结果和方案建议具有更高的科学性和可行性。
3.2.4 Executor (E - 执行者): 模拟执行与验证接口
Executor在SAFE框架中的角色是独特且关键的，它并非直接映射ICS中的某个特定人员或部门，而是承担了连接SAFE内部规划决策与外部（模拟的）执行环境的桥梁作用，专注于行动方案的模拟执行与结果反馈。其核心价值在于为SAFE生成的计划提供一个初步的、基于模拟的可行性验证和效果评估机制。
在SAFE的标准化工作流中，Executor的角色主要在执行验证阶段被激活：
行动方案转译与模拟驱动: 当Strategist完成应急行动方案的制定后，会将其传递给Executor。Executor的核心任务是将这份（通常是自然语言或半结构化描述的）行动方案，转译成执行验证环境 (EVE)（一个标准化的仿真平台或测试接口）能够理解和执行的指令序列或配置参数。随后，Executor负责调用EVE的接口，配置模拟场景，输入指令，启动并驱动整个模拟执行过程。这模拟了将批准的IAP转化为具体行动指令并下达给执行单元的过程，但在一个受控的模拟环境中进行。
执行结果获取与处理: 在模拟执行期间或结束后，Executor负责从EVE获取执行过程的记录和结果数据。这些数据可能包括模拟的时间进程、资源消耗情况、关键状态变化、目标达成度量等。Executor需要对这些原始数据进行初步的处理和格式化，生成一份结构化的**《执行过程报告》**。
Executor的设计特点与考量:
接口抽象性: Executor本身不包含具体的应急领域知识或复杂的决策逻辑。它的核心能力在于理解行动方案的意图，并将其准确地转译为与特定EVE交互所需的标准化指令。它是一个通用的执行接口层。
与EVE的紧密耦合: Executor的功能实现高度依赖于其对接的EVE的能力和接口规范。不同的仿真平台可能需要不同的转译逻辑和交互协议。
信息隔离: Executor在执行模拟时，通常不需要了解方案制定的详细背景或之前的态势分析过程，它只需要关注输入的行动方案和EVE的反馈。同样，框架内的其他角色（S, A, F）在规划阶段也无需感知EVE的存在或其虚拟性质。
验证而非真实执行: 必须强调，Executor执行的是模拟，其目的是验证方案在理想或特定假设条件下的潜在表现，而不是进行真实的物理干预。其输出的《执行过程报告》是用于辅助Strategist进行事后评估和流程回顾的依据。
通过引入Executor和执行验证阶段，SAFE框架不仅能生成计划，还能对其进行初步的检验，形成一个更完整的“规划-模拟-评估”闭环，这对于提升计划质量、识别潜在问题以及作为培训工具都具有重要意义。它也为未来将此类智能规划系统与真实世界的自动化控制系统或机器人执行单元对接提供了概念基础。

3.3 SAFE框架的协作机制：构建结构化的数字应急团队
在定义了SAFE框架的四个核心角色（Strategist, Awareness, Field Expert, Executor）之后，下一个关键问题是如何使这些具有不同职责和能力的智能体能够有效地协同工作，共同完成复杂的应急响应辅助决策任务。为此，SAFE框架设计了一套结构化的协作机制，旨在模拟现实应急指挥体系中（如ICS所倡导的）有序、高效、可追溯的团队合作模式。本节将阐述该协作机制的核心原理，包括信息传递、任务分配与流转规则，以及确保协同有效性的基本原则。
信息交互的核心：结构化消息与共享资产库
为了克服传统多智能体系统中单纯依赖自由对话可能带来的歧义、信息丢失和效率低下问题，SAFE框架的协作机制强调结构化的信息交互。智能体之间的沟通不仅仅是传递自然语言文本，更重要的是传递包含明确意图、上下文和结构化数据的消息 (Messages)。这些消息可以承载任务指令、状态更新、查询请求、分析结果等多种类型的信息。
更进一步，为了确保关键信息的持久化、共享和版本管理，SAFE框架引入了中央信息资产库 (Asset Hub) 的概念（其具体内容在后续章节定义）。智能体在完成其核心任务后，通常会将其产出的关键信息成果（如态势分析报告、风险评估报告、行动方案等）作为结构化的“资产”存储到该库中。后续需要这些信息的智能体则通过唯一的资产标识符进行检索。这种以共享资产库为中心的间接信息交互模式，相比点对点的直接消息传递，具有更好的可追溯性、信息一致性和解耦性，也更贴近现实工作中通过共享文档、数据库或态势图进行信息同步的方式。智能体间的消息更多地用于传递任务指令、状态通知以及对共享资产的引用，而不是传递冗长的数据本身。
任务分配与流转：基于角色的职责驱动与协调
SAFE框架的协作流程主要由Strategist角色驱动，体现了应急指挥中“指挥核心”的作用。Strategist负责理解总体任务目标，并根据预设的标准化工作流程（其具体步骤将在后续章节详述），将任务分解并分配给最适合执行该任务的角色。例如，当需要全面了解态势时，Strategist会向Awareness发出信息收集与分析的任务；当需要专业风险评估或方案制定时，会向相应的Field Expert发出请求。
任务的流转并非完全中心化。虽然Strategist是主要的协调者，但其他角色在完成其任务后，也会根据流程逻辑触发下一步骤或通知相关角色。例如，Awareness完成态势分析后，会通知Strategist态势图景已更新；Field Expert完成方案生成后，会将其提交给Strategist进行评估。这种基于角色职责和流程状态的分布式触发机制，结合Strategist的总体协调，构成了SAFE团队协作的基础。
为了确保任务流转的清晰和有序，SAFE框架强调明确的任务交接 (Handoff) 规则。当一个角色需要将工作（或其阶段性成果）传递给另一个角色时，应通过包含清晰任务描述、所需输入（如资产引用）和预期输出的消息进行传递。我们倾向于采用点对点的、目标明确的任务交接模式，避免任务广播带来的混乱和责任不清。
协作规则与原则：保障协同的有效性与鲁棒性
为了使多智能体协作更加高效、可靠，SAFE框架的设计遵循以下基本原则，这些原则需要在智能体的行为逻辑中得到体现：
职责明确性: 每个智能体被期望严格遵守其被赋予的角色职责，专注于处理其专业领域内的任务，避免越权或处理不相关的信息。
目标一致性: 所有智能体的行动都应服务于Strategist设定的当前阶段总体响应目标，确保团队行动方向的一致性。
沟通规范性: 智能体间的交互应遵循预定义的结构化消息格式，确保信息传递的准确性和机器可解析性。
能力边界意识: 智能体应能意识到自身能力的局限性。当接收到无法完成的任务（由于知识缺乏、权限不足或工具限制）时，应明确拒绝并说明原因，而不是尝试猜测或提供不可靠的输出。
状态透明性: 智能体应能（在框架机制支持下）报告其当前的任务执行状态（如：进行中、已完成、遇到障碍），以便Strategist或其他协调者能够监控整体进度。
信息持久化: 所有关键的中间分析结果和最终产出都应通过标准机制（如写入资产库）进行记录和归档，以保证过程的可追溯性和知识的沉淀。
总结而言，SAFE框架的协作机制旨在通过结构化消息传递、共享信息资产库、基于角色职责的流程驱动以及明确的协作规则，构建一个既能发挥各角色专业优势，又能保证整体行动协调一致、过程清晰可控的智能化协作环境。 这种设计借鉴了传统多智能体系统中关于通信协议、协调策略和组织结构的研究成果，并结合了应急管理领域对标准化、结构化和可追溯性的特定需求，旨在为复杂应急场景下的智能辅助决策提供一个可靠的团队协作基础。

3.4 SAFE框架的标准化操作规程（SOP）与行为模式设计
在明确了SAFE框架的角色体系（3.2节）和协作机制（3.3节）之后，本节将深入阐述支撑该框架运行的核心——标准化的操作规程（SOP）及其内部的任务结构，以及驱动各角色执行这些规程的行为模式。SAFE的SOP设计旨在将应急响应初期的复杂规划与决策过程，结构化为一系列有序、可管理、可评估的关键步骤，并明确每个步骤的目标、职责和产出。其设计深受应急管理领域权威实践指南（如CPG 101, ICS 300）的启发，并针对SAFE作为智能化辅助决策系统的定位进行了适配与精炼。同时，我们将通过行为树（Behavior Tree）这一通用概念，来可视化和解释各角色在执行SOP过程中的决策逻辑和行为选择。
3.4.1 标准化流程的价值与SAFE的借鉴和取舍
应急行动计划（EOP）和标准操作规程（SOP）是现代应急管理体系的基石。它们的核心价值在于提供了一个共同的操作框架和语言，使得在高度复杂、动态变化且充满压力的应急环境中，来自不同机构、具备不同背景的响应人员能够快速形成共识、明确职责、协调行动，从而最大限度地减少混乱、提高效率、保障安全[参考文献 CPG 101]。标准化的流程不仅是行动的指南，更是培训、演练、评估和持续改进的基础。
FEMA的《综合应急准备指南》（CPG 101）提出的六步规划流程，为EOP的制定提供了一个逻辑严谨且普适性强的元框架。其强调的“理解态势”、“确定目标”、“制定与分析方案”、“计划准备”等步骤，深刻揭示了从认知到决策再到计划形成的通用规律，对于任何旨在辅助规划决策的系统都具有重要的指导意义。同样，面向复杂事件的《ICS 300》课程所推广的运作周期计划流程（Planning "P"），则更具体地展示了在持续响应过程中，如何通过标准化的会议、信息流和角色互动，迭代地制定和执行详细的事件行动计划（IAP）。其强调的目标驱动、基于态势、多方参与、周期迭代等原则，以及对**规划组（Planning Section）**核心作用的突出，都为模拟真实的应急规划过程提供了宝贵的实践经验。
SAFE框架在设计其核心SOP时，充分借鉴了CPG 101和ICS 300的这些宝贵思想。我们采纳了CPG 101的结构化步骤思想，将复杂的应急初期规划分解为若干逻辑清晰、目标明确的关键阶段。同时，我们吸收了ICS Planning "P"中对信息处理、态势分析、风险评估、目标设定、方案制定、资源确认等核心规划功能的强调，并将这些功能映射到SAFE的角色职责和SOP步骤中。
然而，SAFE作为一个辅助决策系统原型，其SOP也根据自身定位进行了简化和适配：
聚焦初期规划: SAFE的SOP主要覆盖应急响应的早期信息处理、态势理解、风险评估、目标设定、方案制定和初步计划生成环节，对于CPG 101中更偏重长期实施、维护和演练评估的步骤（如Step 6: Plan Implementation and Maintenance的部分内容）以及ICS Planning "P"中涉及现场具体战术执行协调的部分进行了简化。
简化组织交互: 现实中的Planning "P"涉及大量的跨部门会议和人际沟通协调。SAFE的SOP将其简化为角色之间的结构化信息传递和基于共享资产的协作，更侧重于信息流和逻辑流的模拟。
抽象执行层面: 对于资源管理和行动执行，SAFE的SOP停留在规划和资源确认层面，而不深入到ICS中后勤组（Logistics Section）和行动组（Operations Section）具体的调度和现场执行细节。执行验证阶段（SOP-05, SOP-06）也是通过与抽象的“执行验证环境”交互来完成，而非模拟真实的物理执行。
去除非核心功能: 对于ICS中的财务/行政管理等与核心应急决策关联度较低的功能，SAFE的SOP未予包含。
通过这种借鉴与取舍，SAFE的SOP旨在抓住应急初期规划决策的核心逻辑骨架，并将其转化为一个适合智能化、自动化辅助的结构化流程。
3.4.2 SAFE标准化操作规程（SOP）的设计逻辑与核心任务
SAFE框架的标准化操作规程（SOP）被设计为包含五个核心规划步骤和一个扩展的执行验证步骤（共六步）。每个步骤都围绕一个关键的业务目标展开，并分解为一个或多个需要由指定角色完成的核心任务。这些核心任务要么是相对简单的原子行为，要么是内部包含一系列原子行为的复杂任务（非原子任务）。以下表格（表3.1，对应之前的v8.1版本）概述了SAFE的整体SOP结构：
(表格 Placeholder: 此处应插入之前最终确认的SOP v8.1表格)
这个SOP的设计逻辑体现了从信息输入到态势理解，再到目标设定、方案抉择、资源确认，最终形成行动计划的完整决策链条。每个步骤的产出都为下一步提供了必要的基础。
SOP-01 (事件启动与态势理解): 此阶段的目标是快速响应初始信息，确认事件的真实性与基本情况，并初步建立起对事件性质、范围和潜在影响的理解。核心任务包括记录初始化，确保事件的可追溯性；明确初始目标与约束，为后续规划设定边界；以及最重要的关键要素检查与补全，这是后续所有分析的基础，需要Awareness角色发挥其信息处理的核心能力，确保关键信息的完整与准确。同时，Strategist需要基于初步信息组建（逻辑上的）响应团队并规划后续SOP的执行。
SOP-02 (态势理解与风险评估): 承接上一步获取的关键要素和初步信息，本阶段的目标是形成全面、深入的态势感知和系统的风险评估。核心任务包括多源信息整合，Awareness需要调用各种信息源（通过框架机制）并进行融合处理；综合态势分析，Awareness需要将零散信息转化为对全局态势的理解；以及综合风险评估，需要Awareness进行初步风险识别，并可能由Strategist触发Field Expert进行深度专项评估，最终输出一份综合的风险报告。这一步是后续所有决策的关键依据。
SOP-03 (目标确定与方案制定): 在充分理解态势和风险的基础上，此阶段的目标是将高层目标转化为具体的行动方案。核心任务包括由Strategist设定具体的、可操作的行动目标和优先级；然后由Field Expert（主要）和Strategist（辅助）制定出推荐的行动方案 (CoA)，这个方案应该是基于专业知识和态势分析得出的、解决当前核心问题的最佳策略建议。
SOP-04 (资源确认与计划整合): 方案的有效性离不开资源的支撑。此阶段的目标是确保推荐方案的可行性，并将其整合为可执行的计划。核心任务包括由Strategist确认执行该方案所需的具体资源（人员、设备、物资等）及其当前状态（可用性、位置、ETA等），并分析资源缺口；然后，将推荐方案与资源确认结果进行整合，形成一份包含核心执行要素的行动方案 (Action Plan)。这份行动方案是规划阶段的最终产出。
SOP-05 ((扩展) 行动方案模拟执行): 为了对规划阶段产出的行动方案进行初步验证，引入此扩展步骤。目标是在模拟环境中执行该方案。核心任务是由Executor角色基于行动方案驱动模拟环境运行，并记录执行过程。
SOP-06 ((扩展) 结果检查与复盘): 此阶段的目标是评估模拟执行的效果。核心任务是由Strategist检查模拟执行的结果，将其与原计划目标进行对比，并进行流程回顾与总结，为后续的计划优化或实际执行提供参考。
通过这六个步骤的有序执行，SAFE框架旨在模拟一个精简但逻辑完整的应急规划与初步验证流程。
3.4.3 子SOP示例：Task 2.3 - 综合风险评估
为了更清晰地展示非原子核心任务内部的执行逻辑，我们以SOP-02中的核心任务“Task 2.3 - 综合风险评估”为例，阐述其可能的子流程。需要强调的是，这并非严格的SOP，而是对该复杂任务内部可能包含的原子行为序列的一种逻辑展示。
(图 Placeholder: 此处应插入Task 2.3的子流程图 - 风格应为聚焦原子行为序列)
Task 2.3的目标是输出一份综合风险评估报告。其内部流程可能包含：
Awareness (A) 进行初步风险识别: 基于其生成的态势图景，识别出主要的风险点和类型。
Strategist (S) 进行决策: 根据初步风险识别结果和事件性质，判断是否需要特定领域的专家进行深度评估。
Field Expert (F) 执行深度评估 (若被触发): F接收指令，检索相关信息，利用专业知识或工具进行深度分析和预测。
Strategist (S) 整合评估结果: S整合A的初步识别结果和（可能有的）F的深度评估报告，形成最终的综合风险评估报告。
这个子流程展示了角色间的协作（S决策触发F）和信息整合，以共同完成一个复杂的评估任务。其他标记为[非原子]的核心任务也可以类似地进行内部流程的逻辑梳理。
3.4.4 角色行为模式：基于状态与规则的行为树
为了使SAFE框架中的角色能够根据当前的SOP阶段、任务状态和可用信息，自主地选择并执行恰当的行为，我们采用行为树（Behavior Tree）的思想来对其决策逻辑进行建模。行为树是一种在游戏AI和机器人领域广泛使用的、用于表示复杂行为逻辑的树状结构。它通过组合不同的节点类型（如选择节点、顺序节点、条件节点、动作节点）来描述智能体在不同情境下的反应模式。
以Strategist角色为例，其行为模式可以被抽象为一个行为树：
(图 Placeholder: 此处应插入Strategist的行为分支树 - 最终版)
这个行为树的根节点代表Strategist的激活状态。它首先会检查当前的全局状态（例如，处于哪个SOP步骤，哪个核心任务正在进行，哪些前置资产已就绪）。根据状态检查的结果，行为树会沿着不同的分支进行决策：
条件判断: 每个分支的进入通常伴随着一个或多个条件判断（例如，“是否收到了初始事件信息？”、“态势图景是否已就绪？”、“是否需要进行深度风险评估？”）。
行为选择: 当某个分支的条件满足时，控制流会传递到该分支的叶子节点。根据我们的设计原则，每个叶子节点代表一个明确的、原子化的核心业务行为（Action）或一个触发其他角色执行子流程（SOP或复杂Action）的控制行为。例如，如果当前状态是“初始事件已接收”，则执行“S-Ctrl01: 初始化记录与计划”；如果状态是“态势图景已就绪”，则执行“S-CA01: 评估态势决策风险评估”。
状态驱动: 执行完一个叶子节点的行为后，系统状态会发生改变（例如，新的资产被创建，计划状态被更新）。Strategist会重新从根节点开始检查状态，进入下一个符合条件的分支，从而驱动整个SOP流程的逐步推进。
其他角色（Awareness, Field Expert, Executor）的行为模式也可以用类似的行为树来表示，它们的决策逻辑相对更简单，主要是响应Strategist的指令或完成自身的核心业务处理流程。
通过行为树的建模，我们可以将复杂的应急规划SOP流程，转化为每个角色基于当前状态和规则进行自主决策和行动的模式。这种模式既保证了流程的结构化和有序性，又为智能体根据实际情况进行灵活反应（虽然当前设计中灵活性体现较少，主要按固定流程）提供了基础。它也使得角色的行为逻辑更易于理解、调试和评估。

# SAFE 标准化工作流

| 索引 (ID) | 步骤 (Step Name)              | 核心任务 (Core Task)                                                                                                                                                              | 参与者 (Participants) | 核心输入 (Core Inputs)                                                                 | 核心输出 (Core Outputs)                                                                                             | 援引 (References)                                                                                                |
| :-------- | :---------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------------------- | :------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------ | :--------------------------------------------------------------------------------------------------------------- |
| SOP-01    | **事件启动与规划准备**        | 1.1 **初始事件录入** (Initial Event Logging) **(S)** <br> 1.2 **关键要素检查与补全** (Key Element Check & Completion) **[非原子]** <br> 1.3 **组建响应团队与规划SOP** (Form Response Team & Plan SOP) **[非原子]** | S, A                  | 初始事件信息 (Initial Event Information)                                                 | 事件记录 (EventRecord), 关键要素清单 (KeyElementList), 响应团队配置 (TeamConfiguration), 应急响应计划 (OverallPlan) | CPG 101: Step 1 / ICS 300: Initial Response, Briefing, Initial UC Meeting (部分)                               |
| SOP-02    | **态势理解与风险评估**        | 2.1 **多源信息整合** (Multi-Source Information Integration) **[非原子]** <br> 2.2 **综合态势分析** (Comprehensive Situation Analysis) **(A)** <br> 2.3 **综合风险评估** (Comprehensive Risk Assessment) **[非原子]** | A, F, S               | 事件记录 (EventRecord), 关键要素清单 (KeyElementList), 任务指令 (Task Order from Plan) | 态势分析报告 (SituationAnalysisReport), 风险评估报告 (RiskAssessmentReport)                                         | CPG 101: Step 2 / ICS 300: Info Gathering, Situation Analysis, Risk Assessment (Planning Section & Tech Specialists) |
| SOP-03    | **目标确定与方案制定**        | 3.1 **设定行动目标与优先级** (Set Action Objectives & Priorities) **(S)** <br> 3.2 **制定行动方案 (CoA)** (Develop Course of Action (CoA)) **[非原子]**                               | S, F                  | 态势分析报告 (SituationAnalysisReport), 风险评估报告 (RiskAssessmentReport)              | 行动目标清单 (ActionObjectiveList), 行动方案 (ActionPlan)                                                           | CPG 101: Step 3 & Step 4 / ICS 300: Objectives Meeting, Tactics/Planning Meeting (CoA Development)             |
| SOP-04    | **资源确认与计划定稿**        | 4.1 **确认行动方案所需资源** (Confirm Resources for Action Plan) **[非原子]** <br> 4.2 **定稿应急处置计划** (Finalize Emergency Response Plan) **(S)**                               | S                     | 行动方案 (ActionPlan), 资源基线数据 (Baseline Resource Data)                           | 应急处置计划 (FinalResponsePlan)                                                                                    | CPG 101: Step 4 (Resource) & Step 5 / ICS 300: Planning Meeting (Resource Confirm), IAP Preparation & Approval |
| SOP-05    | **(扩展) 行动方案模拟执行**   | 5.1 **基于处置计划驱动模拟** (Drive Simulation based on Response Plan) **[非原子]**                                                                                             | E                     | 应急处置计划 (FinalResponsePlan)                      | 执行过程日志 (ExecutionLog)                                                                                         | (演练执行)                                                                                                       | (演练执行/Simulation)                                                                                            |
| SOP-06    | **(扩展) 结果检查与复盘**     | 6.1 **检查模拟执行结果** (Check Simulation Execution Results) **(S)** <br> 6.2 **进行流程回顾与总结** (Conduct Process Review & Summary) **(S)**                               | S                     | 应急处置计划 (FinalResponsePlan), 执行过程日志 (ExecutionLog)                          | 执行检查报告 (ExecutionCheckReport), 复盘总结报告 (ReviewSummaryReport)                                             | (演练评估与改进)                                                                                                 | (演练评估/AAR & Closeout)                                                                                        |

## Task 1.2
```
%% Sub-SOP for Task 1.2: Key Element Check & Completion
graph TD
    T12_Start("开始: 输入 EventRecord") --> T12_A01["A: 分析记录, 对比要素模板"];
    T12_A01 --> T12_Decision{"A: 是否缺少关键要素?"};
    T12_Decision -- "是" --> T12_A02["A: 规划信息补全查询"];
    T12_A02 --> T12_A03["A: 执行补充信息查询 (调用外部工具)"];
    T12_A03 --> T12_A04["A: 整合补充信息"];
    T12_A04 --> T12_A05["A: 生成关键要素清单 (KeyElementList)"];
    T12_Decision -- "否" --> T12_A05;
    T12_A05 --> T12_End("结束: 输出 KeyElementList");
```

## Task 1.3
```
%% Sub-SOP for Task 1.3: Form Response Team & Plan SOP
graph TD
    T13_Start("开始: 输入 EventRecord, KeyElementList") --> T13_A01["S: 分析事件类型与初步需求"];
    T13_A01 --> T13_A02["S: 选择并配置所需角色 (A, F等)"];
    T13_A02 --> T13_A03["S: 生成响应团队配置 (TeamConfiguration)"];
    T13_A03 --> T13_A04["S: 规划整体SOP执行流程 (生成OverallPlan)"];
    T13_A04 --> T13_End("结束: 输出 TeamConfiguration, OverallPlan");
```

## Task 2.1
```
%% Sub-SOP for Task 2.1: Multi-Source Information Integration
graph TD
    T21_Start("开始: 输入 任务指令, EventRecord") --> T21_A01["A: 规划详细信息采集范围与来源"];
    T21_A01 --> T21_A02["A: 执行多源信息采集 (循环调用外部工具)"];
    T21_A02 --> T21_A03["A: 清洗、去重、初步分类收集的信息"];
    T21_A03 --> T21_End("结束: 输出 整合后的原始信息集");
```

## Task 2.3
```
%% Sub-SOP for Task 2.3: Comprehensive Risk Assessment
graph TD
    T23_Start("开始: 输入 SituationalPicture") --> T23_A01["A: 进行初步/广度风险识别与判断"];
    T23_A01 --> T23_Decision{"S: (基于A的判断) 需要专家深度评估?"};
    T23_Decision -- "是" --> T23_A02["F: 执行深度/专项风险评估"];
    T23_A02 --> T23_A03["S: 整合初步与深度评估结果"];
    T23_Decision -- "否" --> T23_A03;
    T23_A03 --> T23_End("结束: 输出 RiskAssessmentReport");
```

## Task 3.2
```
%% Sub-SOP for Task 3.2: Develop Recommended Course of Action (CoA)
graph TD
    T32_Start("开始: 输入 InitialObjectives, SituationalPicture, RiskAssessmentReport") --> T32_A01["F: (主要) 生成多个专业CoA选项"];
    T32_A01 --> T32_A02["S: (辅助/整合) 分析评估所有CoA选项"];
    T32_A02 --> T32_A03["S: 选择/确定最终推荐的CoA框架"];
    T32_A03 --> T32_End("结束: 输出 RecommendedCoA");
```

## Task 4.1
```
%% Sub-SOP for Task 4.1: Confirm Resources for Action Plan
graph TD
    T41_Start("开始: 输入 RecommendedCoA, 资源基线数据") --> T41_A01["S: 从CoA中提取详细资源需求列表"];
    T41_A01 --> T41_A02["S: 查询资源管理系统获取实时状态 (通过框架机制)"];
    T41_A02 --> T41_A03["S: 对比需求与可用性, 确认资源清单"];
    T41_A03 --> T41_A04["S: 分析并记录关键资源缺口"];
    T41_A04 --> T41_End("结束: 输出 确认的资源清单与缺口");
```

## Task 5.1
```
%% Sub-SOP for Task 5.1: Drive Simulation based on Response Plan (Executor) - Simplified
graph TD
    T51_Start("开始 Task 5.1") --> T51_S1["输入: ActionPlan"]
    T51_S1 --> T51_S2["E: 转译计划为EVE指令序列"]
    T51_S2 -- "指令序列" --> T51_S3["E: 初始化并配置EVE"]
    T51_S3 --> T51_S4["E: 逐步执行指令并记录过程"]
    T51_S4 -- "执行完成信号/日志" --> T51_S5["E: 获取并格式化最终执行报告"]
    T51_S5 -- "输出: ExecutionLogReport" --> T51_End("结束 Task 5.1")
```

# 角色定义

## Strategist
### 行为树
```
graph TD
    S_CheckState{{"检查当前SOP步骤与任务状态"}}

    S_CheckState -- "SOP-01 / Task 1.1 (原子)" --> S_T11_A01["SAA-LLM_Parse: 解析初始事件"]
    S_T11_A01 --> S_T11_A02["SAA-StoreAsset: 存储 EventRecord"]
    S_T11_A02 --> S_T11_A03["SAA-UpdatePlanStatus: 更新计划 (Task 1.1 完成)"]

    S_CheckState -- "SOP-01 / Task 1.2 (非原子) / SubStep Start" --> S_T12_A01["SAA-TriggerRole: 触发 A 执行要素检查补全"]

    S_CheckState -- "SOP-01 / Task 1.3 (非原子) / SubStep Start" --> S_T13_A01["SAA-LLM_Analyze: 分析事件定团队需求"]
    S_T13_A01 --> S_T13_A02["SAA-LLM_Generate: 生成 TeamConfiguration"]
    S_T13_A02 --> S_T13_A03["SAA-StoreAsset: 存储 TeamConfiguration"]
    S_T13_A03 --> S_T13_A04["SAA-LLM_Generate: 规划整体SOP流程 (OverallPlan)"]
    S_T13_A04 --> S_T13_A05["SAA-StoreAsset: 存储 OverallPlan"]
    S_T13_A05 --> S_T13_A06["SAA-UpdatePlanStatus: 更新计划 (SOP-01 完成, 触发 SOP-02)"]
    S_T13_A06 --> S_T13_A07["SAA-TriggerRole: 触发 A 执行 SOP-02"]

    S_CheckState -- "SOP-02 完成 (A/F通知)" --> S_T2_CheckRisk{"检查 RiskAssessmentReport 是否生成"}
    S_T2_CheckRisk -- "是" --> S_T31_A01_Risk["S-A01a: 基于态势与风险设定目标"]
    S_T2_CheckRisk -- "否" --> S_T31_A01_NoRisk["S-A01b: 基于态势设定目标"]
    S_T31_A01_Risk --> S_T31_A02["SAA-StoreAsset: 存储 InitialObjectives"]
    S_T31_A01_NoRisk --> S_T31_A02
    S_T31_A02 --> S_T31_A03["SAA-UpdatePlanStatus: 更新计划 (SOP-03 Task 3.1 完成, 触发 Task 3.2)"]
    S_T31_A03 --> S_T31_A04["SAA-TriggerRole: 触发 F 执行 CoA 生成"]

    S_CheckState -- "SOP-03 Task 3.2 完成 (F通知)" --> S_T41_A01["S-A02a: 基于评估标准选择CoA"]
    S_T41_A01 --> S_T41_A02["SAA-StoreAsset: 存储 SelectedCoA"]
    S_T41_A02 --> S_T41_A03["SAA-UpdatePlanStatus: 更新计划 (Task 4.1 完成, 触发 Task 4.2)"]

    S_CheckState -- "SOP-04 / Task 4.2 (原子)" --> S_T42_A01["S-A03a: 确认资源状态 (调用资源接口)"]
    S_T42_A01 --> S_T42_A02["S-A03b: 分析资源缺口"]
    S_T42_A02 --> S_T42_A03["SAA-StoreAsset: 存储 确认资源清单与缺口"]
    S_T42_A03 --> S_T42_A04["SAA-UpdatePlanStatus: 更新计划 (SOP-04 完成, 触发 SOP-05)"]

    S_CheckState -- "SOP-05 / Task 5.1 (原子)" --> S_T51_A01["S-A04a: 整合信息生成报告"]
    S_T51_A01 --> S_T51_A02["SAA-StoreAsset: 存储 IncidentInfoReport"]
    S_T51_A02 --> S_T51_A03["SAA-UpdatePlanStatus: 更新计划 (Task 5.1 完成, 触发 Task 5.2)"]

    S_CheckState -- "SOP-05 / Task 5.2 (原子)" --> S_T52_A01["S-A04b: 整合信息编制行动指令集"]
    S_T52_A01 --> S_T52_A02["SAA-StoreAsset: 存储 ActionOrderSet"]
    S_T52_A02 --> S_T52_A03["SAA-UpdatePlanStatus: 更新计划 (SOP-05 完成, 可触发 SOP-06)"]

    S_CheckState -- "SOP-06 / Task 6.1 完成 (E通知)" --> S_T62_A01["S-A05a: 检查模拟执行结果"]
    S_T62_A01 --> S_T62_A02["S-A05b: 进行流程回顾与总结"]
    S_T62_A02 --> S_T62_A03["SAA-StoreAsset: 存储 ExecutionCheckReport, ReviewSummaryReport"]
    S_T62_A03 --> S_T62_A04["SAA-UpdatePlanStatus: 更新计划 (SOP-06 完成, 流程结束)"]
```

## Awareness
### 行为树
```
graph TD
    A_CheckState{{"检查当前SOP步骤与任务状态"}}

    A_CheckState -- "SOP-01 / Task 1.2 (非原子) / SubStep: Start" --> A_T12_A01["SAA-LLM_Verify: 分析记录对比要素模板"]
    A_T12_A01 --> A_T12_Decision{"缺少关键要素?"}
    A_T12_Decision -- "是" --> A_T12_A02["SAA-LLM_Generate: 规划信息补全查询"]
    A_T12_A02 --> A_T12_A03["SAA-CallExternalTool: 执行补充信息查询"]
    A_T12_A03 --> A_T12_A04["SAA-LLM_Analyze: 整合补充信息"]
    A_T12_A04 --> A_T12_A05["SAA-StoreAsset: 生成并存储 KeyElementList"]
    A_T12_Decision -- "否" --> A_T12_A05
    A_T12_A05 --> A_T12_A06["SAA-UpdatePlanStatus: 更新计划 (Task 1.2 完成)"]

    A_CheckState -- "SOP-02 / Task 2.1 (非原子) / SubStep: Start" --> A_T21_A01["SAA-LLM_Generate: 规划信息采集范围与来源"]
    A_T21_A01 --> A_T21_A02["SAA-CallExternalTool: 执行多源信息采集 (循环)"]
    A_T21_A02 --> A_T21_A03["SAA-LLM_Analyze: 清洗、去重、分类信息"]
    A_T21_A03 --> A_T21_A04["SAA-UpdatePlanStatus: 更新计划 (Task 2.1 完成, 触发 Task 2.2)"]

    A_CheckState -- "SOP-02 / Task 2.2 (原子)" --> A_T22_A01["SAA-LLM_Analyze: 进行综合态势分析"]
    A_T22_A01 --> A_T22_A02["SAA-StoreAsset: 存储 SituationalPicture"]
    A_T22_A02 --> A_T22_A03["SAA-UpdatePlanStatus: 更新计划 (Task 2.2 完成, 触发 Task 2.3)"]

    A_CheckState -- "SOP-02 / Task 2.3 (非原子) / SubStep: Start" --> A_T23_A01["SAA-LLM_Analyze: 进行初步风险识别与判断"]
    A_T23_A01 --> A_T23_A02["SAA-UpdatePlanStatus: 更新计划 (Task 2.3 初步完成, 等待S决策)"]

    A_CheckState -- "SOP-02 / Task 2.3 (非原子) / SubStep: Integrate" --> A_T23_A03["SAA-RetrieveAsset: 获取 F 的 RiskAssessmentReport"]
    A_T23_A03 --> A_T23_A04["SAA-LLM_Analyze: 整合形成综合风险评估"]
    A_T23_A04 --> A_T23_A05["SAA-StoreAsset: 存储 RiskAssessmentReport (综合版)"]
    A_T23_A05 --> A_T23_A06["SAA-UpdatePlanStatus: 更新计划 (SOP-02 完成)"]
    A_T23_A06 --> A_T23_A07["SAA-TriggerRole: 通知 S SOP-02 完成"]
```

## Field Expert
### 行为树
```
graph TD
    F_CheckState{{"检查当前SOP步骤与任务状态"}}

    F_CheckState -- "SOP-02 / Task 2.3 (非原子) / SubStep: Execute Deep Risk" --> F_T23_A01["SAA-RetrieveAsset: 获取 SituationalPicture"]
    F_T23_A01 --> F_T23_A02["SAA-CallExternalTool: (可选)调用专业模型/知识库"]
    F_T23_A02 --> F_T23_A03["SAA-LLM_Analyze: 执行深度风险评估"]
    F_T23_A03 --> F_T23_A04["SAA-StoreAsset: 存储 RiskAssessmentReport (专项版)"]
    F_T23_A04 --> F_T23_A05["SAA-UpdatePlanStatus: 更新计划 (Task 2.3 深度评估完成)"]
    F_T23_A05 --> F_T23_A06["SAA-TriggerRole: 通知 A 深度评估完成"]

    F_CheckState -- "SOP-03 / Task 3.2 (非原子) / SubStep: Start" --> F_T32_A01["SAA-RetrieveAsset: 获取 InitialObjectives, SituationalPicture, RiskAssessmentReport"]
    F_T32_A01 --> F_T32_A02["SAA-CallExternalTool: (可选)调用案例库/规则引擎"]
    F_T32_A02 --> F_T32_A03["SAA-LLM_Generate: 生成多个CoA选项"]
    F_T32_A03 --> F_T32_A04["SAA-LLM_Analyze: 对选项进行初步评估"]
    F_T32_A04 --> F_T32_A05["SAA-StoreAsset: 存储 CoAOptionsSet (含初步评估)"]
    F_T32_A05 --> F_T32_A06["SAA-UpdatePlanStatus: 更新计划 (Task 3.2 完成)"]
    F_T32_A06 --> F_T32_A07["SAA-TriggerRole: 通知 S Task 3.2 完成"]
```

## Executor
### 行为树
```
graph TD
    E_CheckState{{"检查当前SOP步骤与任务状态"}}

    E_CheckState -- "SOP-05 / Task 5.1 (非原子) / SubStep: Start" --> E_T51_A01["SAA-RetrieveAsset: 获取 ActionPlan"]
    E_T51_A01 --> E_T51_A02["SAA-LLM_Parse: 转译计划为EVE指令序列"]
    E_T51_A02 --> E_T51_A03["SAA-CallEVE: 配置并初始化EVE环境"]
    E_T51_A03 --> E_T51_ExecLoop{"循环: 执行下一指令"}

    E_T51_ExecLoop -- "有未执行指令" --> E_T51_A04["SAA-CallEVE: 发送下一条指令至EVE"]
    E_T51_A04 --> E_T51_A05["SAA-CallEVE: 查询EVE状态/获取即时反馈"]
    E_T51_A05 --> E_T51_A06["SAA-LogEvent: 记录执行步骤与反馈"]
    E_T51_A06 --> E_T51_Decision{"EVE指示模拟结束 或 所有指令完成?"}
    E_T51_Decision -- "否" --> E_T51_ExecLoop

    E_T51_Decision -- "是" --> E_T51_A07["SAA-CallEVE: 获取最终执行日志/结果"]
    E_T51_A07 --> E_T51_A08["SAA-LLM_Analyze: 处理日志生成报告"]
    E_T51_A08 --> E_T51_A09["SAA-StoreAsset: 存储 ExecutionLogReport"]
    E_T51_A09 --> E_T51_A10["SAA-UpdatePlanStatus: 更新计划 (SOP-05 完成)"]
    E_T51_A10 --> E_T51_A11["SAA-TriggerRole: 通知 S SOP-05 完成"]
```

